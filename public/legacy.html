<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Challenge 1: Vanilla JS to React</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      color: #1976d2;
      margin-bottom: 10px;
    }

    .instructions {
      color: #666;
      margin-bottom: 30px;
      padding: 15px;
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      border-radius: 4px;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    #taskInput {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 4px;
      transition: border-color 0.3s;
    }

    #taskInput:focus {
      outline: none;
      border-color: #1976d2;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }

    #addButton {
      background-color: #1976d2;
      color: white;
    }

    #addButton:hover {
      background-color: #1565c0;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .filter-btn {
      padding: 10px 20px;
      background-color: #e0e0e0;
      color: #333;
      font-size: 14px;
    }

    .filter-btn.active {
      background-color: #1976d2;
      color: white;
    }

    .filter-btn:hover {
      opacity: 0.8;
    }

    #stats {
      display: flex;
      justify-content: space-around;
      padding: 20px;
      background-color: #f5f5f5;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #1976d2;
    }

    #taskList {
      list-style: none;
    }

    .task-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      margin-bottom: 10px;
      background-color: white;
      border: 2px solid #e0e0e0;
      border-radius: 4px;
      transition: all 0.3s;
    }

    .task-item:hover {
      border-color: #1976d2;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
    }

    .task-item.completed {
      opacity: 0.7;
    }

    .task-content {
      display: flex;
      align-items: center;
      flex: 1;
      gap: 12px;
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .task-text {
      font-size: 16px;
    }

    .task-item.completed .task-text {
      text-decoration: line-through;
      color: #999;
    }

    .task-meta {
      font-size: 12px;
      color: #999;
      margin-left: 32px;
    }

    .delete-btn {
      background-color: #d32f2f;
      color: white;
      padding: 8px 16px;
      font-size: 14px;
    }

    .delete-btn:hover {
      background-color: #c62828;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Challenge 1: Vanilla JS â†’ React</h1>
    <div class="instructions">
      <strong>Your Task:</strong> Convert this vanilla JavaScript implementation to a React component.
      Use hooks, proper state management, and React best practices. All functionality must be preserved.

      <h3 style="margin-top: 15px; margin-bottom: 8px; color: #1976d2;">Additional Requirements:</h3>
      <ul style="margin-left: 20px; line-height: 1.6;">
        <li><strong>TanStack Query:</strong> Migrate the user stats fetching to use TanStack Query with proper caching and error handling</li>
        <li><strong>React Hook Form:</strong> Convert the task input form to use React Hook Form with validation</li>
      </ul>
    </div>

    <div class="input-group">
      <input
        type="text"
        id="taskInput"
        placeholder="Enter a new task..."
        autocomplete="off"
      />
      <button id="addButton">Add Task</button>
    </div>

    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="active">Active</button>
      <button class="filter-btn" data-filter="completed">Completed</button>
    </div>

    <div id="stats">
      <div class="stat-item">
        <div class="stat-label">Total</div>
        <div class="stat-value" id="totalCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Active</div>
        <div class="stat-value" id="activeCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Completed</div>
        <div class="stat-value" id="completedCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Global Tasks</div>
        <div class="stat-value" id="globalTaskCount">
          <span style="font-size: 14px; color: #666;">Loading...</span>
        </div>
      </div>
    </div>

    <div id="taskList"></div>
  </div>

  <script>
    let tasks = [];
    let currentFilter = 'all';

    const taskInput = document.getElementById('taskInput');
    const addButton = document.getElementById('addButton');
    const taskList = document.getElementById('taskList');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const totalCount = document.getElementById('totalCount');
    const activeCount = document.getElementById('activeCount');
    const completedCount = document.getElementById('completedCount');
    const globalTaskCount = document.getElementById('globalTaskCount');

    /**
     * Fetch global task statistics from API
     * This should be migrated to TanStack Query with proper caching
     */
    async function fetchGlobalStats() {
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/todos');
        const data = await response.json();
        const count = data.length;
        globalTaskCount.innerHTML = count;
      } catch (error) {
        globalTaskCount.innerHTML = '<span style="font-size: 14px; color: #d32f2f;">Error</span>';
        console.error('Failed to fetch global stats:', error);
      }
    }

    // Fetch global stats on page load and every 30 seconds
    // This polling pattern should be replaced with TanStack Query's refetchInterval
    fetchGlobalStats();
    setInterval(fetchGlobalStats, 30000);

    /**
     * Add a new task
     * This manual validation should be replaced with React Hook Form
     */
    function addTask() {
      const text = taskInput.value.trim();

      // Manual validation - should be replaced with React Hook Form validation
      if (text === '') {
        alert('Please enter a task!');
        return;
      }

      if (text.length < 3) {
        alert('Task must be at least 3 characters long!');
        return;
      }

      if (text.length > 100) {
        alert('Task must be less than 100 characters!');
        return;
      }

      // Check for duplicate tasks
      const duplicate = tasks.find(t => t.text.toLowerCase() === text.toLowerCase());
      if (duplicate) {
        alert('This task already exists!');
        return;
      }

      const task = {
        id: Date.now(),
        text: text,
        completed: false,
        createdAt: new Date().toISOString()
      };

      tasks.push(task);
      taskInput.value = '';
      taskInput.focus();

      renderTasks();
      updateStats();
    }

    function toggleTask(id) {
      const task = tasks.find(t => t.id === id);
      if (task) {
        task.completed = !task.completed;
        renderTasks();
        updateStats();
      }
    }

    function deleteTask(id) {
      tasks = tasks.filter(t => t.id !== id);
      renderTasks();
      updateStats();
    }

    function setFilter(filter) {
      currentFilter = filter;

      filterButtons.forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      renderTasks();
    }

    function formatDate(isoString) {
      const date = new Date(isoString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);

      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins} min ago`;

      const diffHours = Math.floor(diffMins / 60);
      if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;

      const diffDays = Math.floor(diffHours / 24);
      return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
    }

    function renderTasks() {
      let filteredTasks = tasks;

      if (currentFilter === 'active') {
        filteredTasks = tasks.filter(t => !t.completed);
      } else if (currentFilter === 'completed') {
        filteredTasks = tasks.filter(t => t.completed);
      }

      taskList.innerHTML = '';

      if (filteredTasks.length === 0) {
        taskList.innerHTML = `
          <div class="empty-state">
            ${currentFilter === 'all'
              ? 'No tasks yet. Add one above!'
              : `No ${currentFilter} tasks.`}
          </div>
        `;
        return;
      }

      filteredTasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;

        taskElement.innerHTML = `
          <div style="flex: 1;">
            <div class="task-content">
              <input
                type="checkbox"
                class="task-checkbox"
                ${task.completed ? 'checked' : ''}
                onchange="toggleTask(${task.id})"
              />
              <span class="task-text">${task.text}</span>
            </div>
            <div class="task-meta">Created ${formatDate(task.createdAt)}</div>
          </div>
          <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
        `;

        taskList.appendChild(taskElement);
      });
    }

    function updateStats() {
      const total = tasks.length;
      const active = tasks.filter(t => !t.completed).length;
      const completed = tasks.filter(t => t.completed).length;

      totalCount.textContent = total;
      activeCount.textContent = active;
      completedCount.textContent = completed;
    }

    addButton.addEventListener('click', addTask);

    taskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addTask();
      }
    });

    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => setFilter(btn.dataset.filter));
    });

    renderTasks();
    updateStats();
  </script>
</body>
</html>
